<h2>Editing {{.Entry.Date}}</h2>
<form action="/entries/{{.Entry.Date}}" method="POST" class="form" id="mp-entry-form">
  <div class="form-group" id="mp-entry-body">
    <textarea name="body" rows="20" cols="80" class="form-control">{{.Entry.Body}}</textarea>
    <p class="pull-right"><span class="char-count">{{charCount .Entry.Body}}</span> characters</p>
  </div>
  <div class="form-group">
    <input type="submit" value="Save" class="btn btn-primary mp-save-button">
  </div>
</form>
<script>
  jQuery(function ($) {
    var isDirty = false;
    var $entryForm = $('#mp-entry-form');
    var $entryBody = $('#mp-entry-body').on('keyup', function () {
      becomeDirty();
      updateCount();
    });
    var $textarea = $entryBody.find('textarea');
    var $charCount = $entryBody.find('.char-count');
    var $saveButton = $('.mp-save-button');

    function updateCount() {
      var count = $textarea.val().length;
      $charCount.text(count);
    }

    function becomeDirty() {
      isDirty = true;
      $saveButton.removeClass('disabled');
    }

    function becomeClean() {
      isDirty = false;
      $saveButton.addClass('disabled');
    }

    function autoSave() {
      if (!isDirty) {
        console.log('nothing to post');
        wait();
        return;
      }

      var options = {
        type: 'POST',
        url: $entryForm.attr('action'),
        data: { body: $textarea.val() }
      };

      becomeClean();

      $.ajax(options).done(function () {
        console.log('success');
      }).fail(function () {
        console.log('failure');
        becomeDirty();
      }).always(function () {
        wait();
      });
    }

    function wait() {
      setTimeout(autoSave, 5000);
    }

    becomeClean();
    wait();
  });
</script>
